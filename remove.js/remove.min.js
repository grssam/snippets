/* Copyright (C) 2013 Girish Sharma <scrapmachines@gmail.com> | http://mozilla.org/MPL/2.0/ */
(function(a,b){if(typeof define==="function"&&define.amd){define(["exports"],b)}else{if(typeof exports!=="undefined"){b(exports)}else{b((a.remove={}))}}}(this,function(a){var b={};function d(l,m){b=m||{replacement:"",whiteList:[]};var h=l.split(/[ _=]+/g).length,g=f(l),k=g.length,n=b.COEFF_LENGTH_MIN||0.5,j=b.COEFF_LENGTH_MAX||0.75;if(g+""=="true"||(k>=n*h&&h<5)||(k>=j*h&&h>=5)){var i=b.replacement||"";if(i.split(/[\/]/g).length>3||!i){return l}return c(i)}else{if(g+""!="false"&&g+""!="true"&&((k<0.6*n*h||l.indexOf("=")<0&&k<=n*h)&&h<=8||k<0.75*n*h&&h>8)){return l.split(/[ _]/g).filter(function(o,p){return g.indexOf(p)<0}).join(" ")}}return l}function f(l){var k=l.split(/[ _]/g),q=k.length;if(q>1){var t=0,n=0,r=[];for(var m=0;m<q;m++){n=f(k[m])==true?1:0;t+=n;if(n==1){r.push(m)}}return t==0?false:r}else{if(l.split(".").length>1&&l.split(".").length<4){return f(l.replace("."," "))==false?false:true}else{if(l.indexOf("/")>=0){return false}var o=["http","https","id","aurora","xpcom","hawaii","src","sdk","string","three"];o.push.apply(b.whiteList||[]);if(o.indexOf(l)>-1){return false}var j=0,p=0,s=0,h=false;l=l.toLowerCase();var g=l.length;j=l.split(/[^0-9]/).length-1;p=g-j;if(g<6&&j<=2){return false}else{if(g>=6&&((j>2&&p>0&&j<g-1)||(j==0))){return true}}s=l.split(/[aeiouyаеёиоуыэюяAЕЁИОУЫЭЮЯ]/).length-1;if(s>1){l.split(/[aeiouyаеёиоуыэюяAЕЁИОУЫЭЮЯ]/).some(function(i){if(f(i)){h=true;return true}})}if(p<=2&&l.split(/[0-9]/g).length<=2&&((g<6&&s>0&&!h)||(g>=6&&p<=2&&s>0&&!h&&j/s<5&&j/s>1.5))){return false}return true}}}function c(h,k){h=h.split(/\s+/);k=(k||[]).filter(function(i){return i.length>3||i.match(/[0-9]+/)});var l=0,g,j=k.length;function m(p){if(p==h[l-1]||p==h[l+1]||p==h[l+2]){return true}p=p.toLowerCase().replace(/[^0-9a-zA-Z\u0400-\u04FF\u0500-\u052F]+/g,"");for(var i=0;i<j;i++){try{if(p.search(k[i])>=0||k[i].search(p)>=0){return true}}catch(o){}}return false}k=k.map(function(i){return i.toLowerCase().replace(/[^0-9a-zA-Z\u0400-\u04FF\u0500-\u052F]+/g,"")});l=0;var n=h.length;while(l<n){if(m(h[l])&&(l<2||l>Math.max(n-3,0.75*n))){h.splice(l,1);l=0;n=h.length}else{l++}}g=h.length;l=0;while(l<g){h[l]=h[l].replace(/[^a-zA-Z0-9\u0400-\u04FF\u0500-\u052F]+$/,"").replace(/^[^a-zA-Z0-9\u0400-\u04FF\u0500-\u052F]+/,"");if(((l==0||l==g-1)&&h[l].search(/^[^a-zA-Z0-9\u0400-\u04FF\u0500-\u052F]+$/)>=0)||(l==g-1&&h[l].search(/^(the|a|an|for)$/i)>=0)){h.splice(l,1);l=Math.max(l-2,0);g=h.length}else{l++}}return h.filter(function(i){return i.length}).join(" ")}function e(o,j,g){if(o==null){return null}function p(t){var r=0;for(var s=0;s<t.length;s++){r+=t[s].length+1}return --r}j=j||40;var h=j;if(g==null){g=true}if(o.length>j){var q=o.split(" "),i="";if(q.length>1){var n=-1;Array.some(q,function(r){if(i.length>2*j/3){return true}else{if(i.length+r.length<2*j/3){i+=r+" ";h-=(r.length+1);n++}else{return true}}});if(n==-1){var m=q[0].length/p(q);i=e(q[0],j*m,true)+" ";h-=i.length;n++}if(q.length>2){i+="… ";h-=2}if(n<q.length-1){var l=q.length-1,k="";while(h>q[l].length&&l>n){k=" "+q[l]+k;h-=(q[l--].length+1)}if(l-n<=1){i=i.replace(" … "," ");h+=2}if(l>n&&h>2){k=e(q[l],h,false)+k}i+=k}return i}else{if(g==false){return"…"+o.slice(o.length-j+1,o.length)}else{if(g==true){return o.slice(0,j-1)+"…"}}}}return o}if(typeof $!=="undefined"&&!!$.fn){$.fn.rG=$.fn.removeGibberish=function(g){var h=$.extend({whiteList:[],COEFF_LENGTH_MIN:0.5,COEFF_LENGTH_MAX:0.75},g);return $(this).map(function(){return d(this,h)})};$.fn.rR=$.fn.removeRedundant=function(g){return $(this).map(function(){return c(this,g||[])})};$.fn.rC=$.fn.removeCharacters=function(g,h){return $(this).map(function(){return e(this,g,h)})}}a.gibberish=d;a.redundant=c;a.characters=e;return a}));
